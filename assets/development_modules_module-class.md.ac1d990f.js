import{_ as s,o as a,c as n,S as e}from"./chunks/framework.f15d8f8c.js";const y=JSON.parse('{"title":"The Module Class","description":"","frontmatter":{},"headers":[],"relativePath":"development/modules/module-class.md","filePath":"development/modules/module-class.md"}'),l={name:"development/modules/module-class.md"},o=e(`<h1 id="the-module-class" tabindex="-1">The Module Class <a class="header-anchor" href="#the-module-class" aria-label="Permalink to &quot;The Module Class&quot;">​</a></h1><p>Every module needs a module class. This class is essentially the &quot;entrypoint&quot; of a module. In many cases, the class does nothing other than providing some meta information about the module.</p><p>The application&#39;s core will look for any class that annotates the <code>[Module]</code> attribute and check if it inherits <code>EvoScModule</code>.</p><p>Besides the class providing some basic information about a module, it can also handle module specific events. These events includes enabling and disabling a module, as well as installing and uninstalling a module.</p><h2 id="defining-the-module-class" tabindex="-1">Defining the module class <a class="header-anchor" href="#defining-the-module-class" aria-label="Permalink to &quot;Defining the module class&quot;">​</a></h2><p>The module class definition is very simple. Create a new class, annotate it with the <code>[Module]</code> attribute and inherit <code>EvoScModule</code> and you are done! Optionally, inherit interfaces to handle enabling/disabling or installing/uninstalling.</p><p>For example, let&#39;s define a module class of a new module <code>ExampleModule</code>:</p><div class="language-csharp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">Module</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ExampleModule</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EvoScModule</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="loading-a-module" tabindex="-1">Loading a module <a class="header-anchor" href="#loading-a-module" aria-label="Permalink to &quot;Loading a module&quot;">​</a></h2><p>The constructor of a module class acts as a &quot;On Load&quot; handler. When you load an event, you are only meant to set up basic things like variables or lists. The &quot;on load&quot; event for modules is therefore intentionally restricted to constructors, as you are not meant to put much logic in here.</p><p>If you need some type of logic to set something up, perhaps you need to set things up in a async context, then use enable/disable or install/uninstall methods which is explained later.</p><p>The constructor also supports dependency injection, and it will have access to the core&#39;s services, as well as the module&#39;s own services:</p><div class="language-csharp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">Module</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ExampleModule</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EvoScModule</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ExampleModule</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">MyService</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">service</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// do something with MyService ...</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="toggleable-modules" tabindex="-1">Toggleable Modules <a class="header-anchor" href="#toggleable-modules" aria-label="Permalink to &quot;Toggleable Modules&quot;">​</a></h2><p>If you only use the framework&#39;s functionality providers, you normally don&#39;t need to handle the enabling or disabling events. However, sometimes it is neccessary to create some background service or custom service that requires the ability to be enabled or disabled.</p><p>In order to ensure that modules are enabled and disabled when a user clicks those buttons, you can inherit the <code>IToggleable</code> interface.</p><p>The interface exposes two asynchronous methods, <code>EnableAsync</code> and <code>DisableAsync</code>. These method names are pretty self-explainatory, but keep in mind that enabling or disabling a module does not mean loading or unloading a module.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>When a module is disabled, it is still loaded in memory, but the logic should not respond to anything.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>For things that might run in the background for a prolonged time, it is recommended to use <a href="/development/modules/advanced/services.html#background-services">Background Services</a>.</p></div><p>Example with <code>IToggleable</code>:</p><div class="language-csharp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">Module</span><span style="color:#89DDFF;">]</span></span>
<span class="line has-focus"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ExampleModule</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EvoScModule</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IToggleable</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Task</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">EnableAsync</span><span style="color:#89DDFF;">()</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// enable stuff in the module</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Task</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">DisableAsync</span><span style="color:#89DDFF;">()</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// disable stuff from the module</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="installable-modules" tabindex="-1">Installable Modules <a class="header-anchor" href="#installable-modules" aria-label="Permalink to &quot;Installable Modules&quot;">​</a></h2><p>Before a module is enabled, it is &quot;installed&quot;. This typically means setting up more permanent objects and data such as running database migrations, or creating and editing certain files. It is possible to hook into this event by implementing the <code>IInstallable</code> interface on the module class.</p><p>It provides two methods, one for when a module is installed (<code>InstallAsync</code>), and another for when a module is uninstalled (<code>UninstallAsync</code>).</p><p>Keep in mind that things such as running migrations is already automatically done and does not need to be triggered by implementing this interface.</p><p>Example with <code>IInstallable</code></p><div class="language-csharp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki material-theme-palenight has-focused-lines"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">Module</span><span style="color:#89DDFF;">]</span></span>
<span class="line has-focus"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ExampleModule</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EvoScModule</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IInstallable</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Task</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">InstallAsync</span><span style="color:#89DDFF;">()</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// install more permanent things for the module</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line has-focus"></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Task</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">UninstallAsync</span><span style="color:#89DDFF;">()</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line has-focus"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// uninstall, remove and clean up any changes</span></span>
<span class="line has-focus"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="module-loading-process" tabindex="-1">Module Loading Process <a class="header-anchor" href="#module-loading-process" aria-label="Permalink to &quot;Module Loading Process&quot;">​</a></h2><p>Understanding the way modules are loaded and and the order in which the special module events are triggered can be useful.</p><p>On start up, the application looks for assemblies with a class that annotates the <code>[Module]</code> attribute. If this attribute is found, it checks if the class inherits <code>EvoScModule</code>.</p><p>If these two conditions are met, the application will look for any dependencies defined by the module. If there are any dependencies, these are loaded first.</p><p>Before the module class itself is loaded, the applicaiton looks for any framework defined entities, for example controllers, settings, permissions, middlewares, database migrations etc.</p><p>The module class is then loaded, which means the class itself is instantiated and the constructor called.</p><p>After the module is loaded, it is then installed. This sets up things like permissions or database migrations.</p><p>If installation is successful, the module is enabled. When a module is enabled, it adds things like controllers, middlewares, events, chat commands, module services etc. All of these things should be enabled automatically.</p>`,35),p=[o];function t(c,i,r,d,u,h){return a(),n("div",null,p)}const b=s(l,[["render",t]]);export{y as __pageData,b as default};
